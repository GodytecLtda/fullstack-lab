<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Fullstack Lab do Adelmo 游</title>
</head>
<body>
  <h1>Fullstack Lab do Adelmo 游</h1>

  <h2>Teste da API</h2>

  <button id="btnHealth">Chamar /api/health</button>
  <pre id="healthResult"></pre>

  <button id="btnMsg">Chamar /api/message</button>
  <pre id="msgResult"></pre>

  <hr />

  <h2>Cadastro de Usu치rio</h2>

  <form id="userForm">
    <label>
      Nome:
      <input type="text" id="nameInput" required />
    </label>
    <br /><br />
    <label>
      E-mail:
      <input type="email" id="emailInput" required />
    </label>
    <br /><br />
    <button type="submit">Cadastrar usu치rio</button>
  </form>

  <pre id="userCreateResult"></pre>

  <h3>Lista de usu치rios</h3>
  <button id="btnLoadUsers">Carregar /api/users</button>
  <pre id="usersList"></pre>

  <script>
    async function callApi(path, outputId) {
      const out = document.getElementById(outputId);
      out.textContent = "Carregando...";
      try {
        const res = await fetch(path);
        const data = await res.json();
        out.textContent = JSON.stringify(data, null, 2);
      } catch (err) {
        out.textContent = "Erro: " + err.message;
      }
    }

    // Bot칫es de teste
    document
      .getElementById("btnHealth")
      .addEventListener("click", () => callApi("/api/health", "healthResult"));

    document
      .getElementById("btnMsg")
      .addEventListener("click", () => callApi("/api/message", "msgResult"));

    // Cadastro de usu치rio
    const form = document.getElementById("userForm");
    form.addEventListener("submit", async (event) => {
      event.preventDefault(); // n칚o recarregar a p치gina

      const name = document.getElementById("nameInput").value.trim();
      const email = document.getElementById("emailInput").value.trim();
      const out = document.getElementById("userCreateResult");
      out.textContent = "Enviando...";

      if (!name || !email) {
        out.textContent = "Preencha nome e e-mail.";
        return;
      }

      try {
        const res = await fetch("/api/users", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name, email }),
        });

        const data = await res.json();

        if (!res.ok) {
          out.textContent = "Erro ao cadastrar: " + (data.error || res.status);
          return;
        }

        out.textContent = "Usu치rio criado:\n" + JSON.stringify(data, null, 2);

        // limpar campos
        form.reset();
      } catch (err) {
        out.textContent = "Erro de rede: " + err.message;
      }
    });

    // Listar usu치rios
    document
      .getElementById("btnLoadUsers")
      .addEventListener("click", () => callApi("/api/users", "usersList"));
  </script>
</body>
</html>
